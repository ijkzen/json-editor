<div class="pl-2" [class.pl-4]="depth > 0">
    <div class="flex items-start gap-2 py-1">
        <button type="button" class="mt-0.5 h-6 w-6 flex items-center justify-center rounded hover:bg-slate-100 dark:hover:bg-slate-800"
            (click)="toggle()" [class.opacity-0]="!isContainer()"
            [attr.aria-label]="isContainer() ? (expanded() ? 'Collapse' : 'Expand') : null">
            <mat-icon class="text-slate-600 dark:text-slate-300" [class.rotate-90]="expanded()">chevron_right</mat-icon>
        </button>

        <div class="min-w-0 flex-1">
            <div class="flex items-center gap-2 flex-wrap">
                @if (nodeKey !== null) {
                <span class="font-mono text-slate-800 dark:text-slate-100">
                    @if (typeof nodeKey === 'string') {
                    <span>{{ nodeKey }}</span>
                    } @else {
                    <span>[{{ nodeKey }}]</span>
                    }
                    <span class="text-slate-400 dark:text-slate-500">:</span>
                </span>
                }

                @if (isContainer()) {
                <span class="font-mono text-xs px-2 py-0.5 rounded bg-slate-100 dark:bg-slate-800 {{ typeClass() }}">
                    {{ containerSummary() }}
                </span>
                }

                @if (nodeType() === 'string') {
                <span class="font-mono inline-flex items-center gap-1 max-w-full {{ typeClass() }}">
                    @if (stringTags().length) {
                    <span class="inline-flex items-center gap-0.5 shrink-0">
                        @for (tag of stringTags(); track tag.kind) {
                        <span
                            class="text-[8px] leading-3 uppercase tracking-normal px-1 py-0.5 rounded-sm border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-700 dark:text-slate-200"
                            [style.backgroundColor]="tag.kind === 'color' ? colorCss(tag) : null"
                            [style.color]="tag.kind === 'color' ? tag.textColor : null">
                            {{ tag.label }}
                        </span>
                        }
                    </span>
                    }

                    @if (linkHref()) {
                    <a class="block min-w-0 max-w-full whitespace-nowrap cursor-pointer underline decoration-dotted"
                        [href]="linkHref()" target="_blank" rel="noopener noreferrer" title="点击打开链接">
                        {{ displayString() }}
                    </a>
                    } @else if (emailHref()) {
                    <a class="block min-w-0 max-w-full whitespace-nowrap cursor-pointer underline decoration-dotted"
                        [href]="emailHref()" target="_blank" rel="noopener noreferrer" title="点击发送邮件">
                        {{ displayString() }}
                    </a>
                    } @else {
                    <span class="block min-w-0 max-w-full whitespace-nowrap" [class.cursor-pointer]="isLongString()"
                        [class.underline]="isLongString()" [class.decoration-dotted]="isLongString()"
                        (click)="openFullString()" [title]="isLongString() ? '点击查看完整内容' : null">
                        {{ displayString() }}
                    </span>
                    }

                    @if (timeDisplay()) {
                    <span class="text-[11px] text-slate-500 dark:text-slate-400 font-mono shrink-0">{{ timeDisplay() }}</span>
                    }
                </span>
                } @else if (nodeType() === 'number') {
                <span class="font-mono inline-flex items-center gap-1 {{ typeClass() }}">
                    @if (numberTags().length) {
                    <span class="inline-flex items-center gap-0.5 shrink-0">
                        @for (tag of numberTags(); track tag.kind) {
                        <span
                            class="text-[8px] leading-3 uppercase tracking-normal px-1 py-0.5 rounded-sm border bg-white dark:bg-slate-900 text-slate-700 dark:text-slate-200 border-slate-200 dark:border-slate-700">
                            {{ tag.label }}
                        </span>
                        }
                    </span>
                    }
                    <span>{{ formatPrimitive() }}</span>
                    @if (timeDisplay()) {
                    <span class="text-[11px] text-slate-500 dark:text-slate-400 font-mono shrink-0">{{ timeDisplay() }}</span>
                    }
                </span>
                } @else if (!isContainer()) {
                <span class="font-mono {{ typeClass() }}">
                    {{ formatPrimitive() }}
                </span>
                }
            </div>
        </div>
    </div>

    @if (isContainer() && expanded()) {
    <div class="border-l border-slate-200 dark:border-slate-700 ml-3">
        @for (child of children(); track child.key) {
        <app-json-node [nodeKey]="child.key" [value]="child.value" [depth]="depth + 1" />
        }
    </div>
    }
</div>